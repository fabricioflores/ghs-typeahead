/*
 * ghs-typeahead
 * http://angular-ui.github.io/bootstrap/

 * Version: 0.13.4 - 2015-10-09
 * License: MIT
 */
angular.module("ghs.bootstrap",["ghs.bootstrap.typeahead"]),angular.module("ghs.bootstrap.typeahead",["ui.bootstrap.position","ui.bootstrap.bindHtml"]).factory("typeaheadParser",["$parse",function(a){var b=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(c){var d=c.match(b);if(!d)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+c+'".');return{itemName:d[3],source:a(d[4]),viewMapper:a(d[2]||d[1]),modelMapper:a(d[1])}}}}]).directive("typeahead",["$compile","$parse","$q","$timeout","$document","$position","typeaheadParser",function(a,b,c,d,e,f,g){var h=[9,13,27,38,40];return{require:"ngModel",link:function(i,j,k,l){function m(a){for(var b=0,c=a.target;c&&4>=b;c=c.parentNode){if(c===j[0]||c===j[0].nextSibling)return!0;b++}return!1}var n=(i.$eval(k.typeaheadMinLength)||1,i.$eval(k.typeaheadWaitMs)||0),o=i.$eval(k.typeaheadEditable)!==!1,p=b(k.typeaheadLoading).assign||angular.noop,q=b(k.typeaheadOnSelect),r=k.typeaheadInputFormatter?b(k.typeaheadInputFormatter):void 0,s=k.typeaheadAppendToBody?i.$eval(k.typeaheadAppendToBody):!1,t=b(k.ngModel).assign,u=g.parse(k.typeahead),v=!0,w=!0,x=k.exposeReload?i.$eval(k.exposeReload):!1,y=i.$new();i.$on("$destroy",function(){y.$destroy()}),y.popupState={visible:!1},y.matches=[];var z="typeahead-"+y.$id+"-"+Math.floor(1e4*Math.random());j.attr({"aria-autocomplete":"list","aria-expanded":!1,"aria-owns":z});var A=function(){v&&!y.popupState.visible&&(y.popupState.visible=!0,E(l.$viewValue),y.$digest())};j.on("click",function(){A()}),j.on("focus",function(){A()});var B=angular.element("<div typeahead-popup></div>");B.attr({id:z,matches:"matches",active:"activeIdx",select:"select(activeIdx)",query:"query",position:"position","popup-state":"popupState"}),angular.isDefined(k.typeaheadTemplateUrl)&&B.attr("template-url",k.typeaheadTemplateUrl);var C=function(){y.activeIdx=-1,y.popupState.visible=!1,j.attr("aria-expanded",!1)},D=function(a){return z+"-option-"+a};y.$watch("activeIdx",function(a){0>a?j.removeAttr("aria-activedescendant"):j.attr("aria-activedescendant",D(a))});var E=function(a){var b={$viewValue:a};p(i,!0),c.when(u.source(i,b)).then(function(c){var d=a===l.$viewValue;if(d&&y.popupState.visible)if(M(),c.length>0){y.activeIdx=-1,y.matches.length=0;for(var e=0;e<c.length;e++)b[u.itemName]=c[e],y.matches.push({id:D(e),label:u.viewMapper(y,b),model:c[e]});y.query=a,y.position=s?f.offset(j):f.position(j),y.position.top=y.position.top+j.prop("offsetHeight"),j.attr("aria-expanded",!0)}else y.matches.length=0,C();d&&p(i,!1)},function(){C(),p(i,!1)})};x&&(i.ngTypeaheadReload=E),C(),y.query=void 0;var F,G,H,I=function(a){F=d(function(){E(a)},n)},J=function(){F&&d.cancel(F)},K=function(){L(),v=!1,G=d(function(){v=!0,y.$digest()},250)},L=function(){G&&d.cancel(G)},M=function(){N(),w=!1,H=d(function(){w=!0,y.$digest()},250)},N=function(){H&&d.cancel(H)};l.$parsers.unshift(function(a){return y.popupState.visible=!0,n>0?(J(),I(a)):E(a),o?a:a?void l.$setValidity("editable",!1):(l.$setValidity("editable",!0),a)}),l.$formatters.push(function(a){var b,c,d={};return r?(d.$model=a,r(i,d)):(d[u.itemName]=a,b=u.viewMapper(i,d),d[u.itemName]=void 0,c=u.viewMapper(i,d),b!==c?b:a)}),y.select=function(a){var b,c,e={};w&&a>=0&&y.matches.length&&(e[u.itemName]=c=y.matches[a].model,c.ngDisabled||(b=u.modelMapper(i,e),t(i,b),l.$setValidity("editable",!0),q(i,{$item:c,$model:b,$label:u.viewMapper(i,e)}),K(),C(),d(function(){j[0].focus()},0,!1)))},j.bind("keydown",function(a){y.popupState.visible&&-1!==h.indexOf(a.which)&&(40===a.which?(a.preventDefault(),y.activeIdx=(y.activeIdx+1)%y.matches.length,y.$digest()):38===a.which?(a.preventDefault(),-1===y.activeIdx&&(y.activeIdx=0),y.activeIdx=(y.activeIdx?y.activeIdx:y.matches.length)-1,y.$digest()):13===a.which||9===a.which?-1!==y.activeIdx?(a.preventDefault(),y.$apply(function(){y.select(y.activeIdx)})):(C(),y.$digest()):27===a.which&&(a.preventDefault(),a.stopPropagation(),C(),y.$digest()))});var O=function(a){w&&!m(a)&&(C(),y.$digest())};e.bind("click",O),i.$on("$destroy",function(){e.unbind("click",O)});var P=a(B)(y);s?e.find("body").append(P):j.after(P)}}}]).directive("typeaheadPopup",function(){return{restrict:"EA",scope:{matches:"=",query:"=",active:"=",position:"=",select:"&",popupState:"="},replace:!0,templateUrl:"template/typeahead/typeahead-popup.html",link:function(a,b,c){a.templateUrl=c.templateUrl,a.isOpen=function(){return a.popupState.visible&&a.matches.length>0},a.isActive=function(b){return a.active==b},a.selectActive=function(b){a.active=b},a.selectMatch=function(b){a.select({activeIdx:b})}}}}).directive("typeaheadMatch",["$http","$templateCache","$compile","$parse",function(a,b,c,d){return{restrict:"EA",scope:{index:"=",match:"=",query:"="},link:function(e,f,g){var h=d(g.templateUrl)(e.$parent)||"template/typeahead/typeahead-match.html";a.get(h,{cache:b}).success(function(a){f.replaceWith(c(a.trim())(e))})}}}]).filter("typeaheadHighlight",function(){function a(a){return a.replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")}return function(b,c){return c?(""+b).replace(new RegExp(a(c),"gi"),"<strong>$&</strong>"):b}});